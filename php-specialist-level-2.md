### Изучение Cookie

Для сохранения cookie используем функцию `setcookie();`. Которая принимает семь параметров, из которых один обязательный.
##### Cookie имеет время жизни

- Временная - та которая хранится до закрытия браузера (вкладки).

- Долговременная - та, которой передан третий параметр, время хранения. Например: `time()+3600` - на один час.

##### Удаление Cookie

Отправляем запрос с "отрицательным" значением времени:

```php
setcookie("name", "John", time()-3600);
```

##### Массивы и Cookie

Так как все передаваемые запросы на сервер это строка, для пеедачи массива данных, нам необходимо произвести сериализацию (перевод массива в зашифрованную строку) и упаковать для сохранения целосности.

```php
$user = [
    'name' => 'John',
    'login' => 'root',
    'password' => '1234'
];
$str = base64_encode(serialize($user));
setcookie("user", $str);

// Получение куки
$user = unserialize(base64_decode($_COOKIE["user"]));
```

### HTTP-заголовки ответа сервера

##### Переадресация ресурса

```php
// Переадресация со статусом 302
header("Location: http://mysite.local");
```

Для избегания повторной отправки данных формы методом POST, после обработки формы производим перезапрос методом GET. 

_Пример:_

```php
if($_SERVER["REQUEST_METHOD"] == "POST") {
    // Форма передавала информацию
    $name = strip_tags($_POST["name"]);
    $age = $_POST["age"] * 1;

    // Сохранение в cookie
    setcookie("userName", $name);
    setcookie("userAge", $age);

    // Обработка формы
    // ...

    // Перезапрос формы методом GET
    header("Location: " . $_SERVER["PHP_SELF"]);
    exit;
}
```

Используем языковую конструкцию `exit;` для остановки выполнения скрипта. Так как страница будет переадресована и выполнение кода ниже данной переадресации не имеет смысла. Без данной конструкции ресурс будет тратиться впустую.

##### Перезапрос ресурса

```php
header("Refresh: 3");
header("Refresh: 3; url=http://mysite.local");
```

В данном случае `3` является время через которое должен произойти перезапрос (перезагрузка страницы). Вторым параметром можно указать адрес переадресации.

##### Установка типов содержимого

```php
// Принудительная установка типа передаваемого ресурса
header("Content-Type: text/xml");
// Принудительная установка кодировки передаваемого ресурса
header("Content-Type: text/html; charset=utf-8");
// Перенаправление вывода передаваемых данных
header("Content-Type: text/plain");
header("Content-Disposition: attachment filename=\"myfile.txt\"");
```

##### Управление кешированием

```php
// Запрет кэширования
header("Cache-Control: no-cache, max-age=0");
// Полный запрет кэширования
header("Cache-Control: no-store");
// Разрешение кэширования на один час относительно времени запроса
header("Cache-Control: max-age=3600");
// Разрешение кэширования на один час
header("Expires: " . date("r", time() + 3600);
```

`no-cache` - не запрещает временное кеширование.